!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.RevealVideoSync=e()}}(function(){return function e(t,i,n){function r(a,s){if(!i[a]){if(!t[a]){var d="function"==typeof require&&require;if(!s&&d)return d(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){var i=t[a][1][e];return r(i?i:e)},u,u.exports,e,t,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e,t,i){function n(e){for(;e&&e!==document;)e=e.parentNode;return e===document}function r(e,t){return-1!==(" "+e.className.trim()+" ").indexOf(" "+t+" ")}function o(e,t){var i=" "+e.className.trim()+" ";-1===i.indexOf(" "+t+" ")&&(i+=" "+t),e.className=i.trim()}function a(e,t){for(var i=" "+e.className.trim()+" ";-1!==i.indexOf(" "+t+" ");)i=i.replace(" "+t+" "," ");e.className=i.trim()}i.isAttached=n,i.hasClass=r,i.addClass=o,i.removeClass=a},{}],2:[function(e,t,i){function n(e){return e.h=e.h||0,e.v=e.v||0,e.f="number"!=typeof e.f||isNaN(e.f)?-1:e.f,e}function r(e,t){return e&&t?e.h===t.h&&e.v===t.v&&e.f===t.f:!e&&!t}function o(e){var t,i,r,o=e.split("/");if(isNaN(parseInt(o[0],10))){var a,s=o[0];if(/^[a-zA-Z][\w:.-]*$/.test(s)&&(a=document.getElementById(s)),!a)return null;var d=Reveal.getIndices(a);t=d.h,i=d.v,r=parseInt(o[1],10)}else t=parseInt(o[0],10),i=parseInt(o[1],10),r=parseInt(o[2],10);return n({h:t,v:i,f:r})}function a(e){Reveal.slide(e.h,e.v,e.f)}i.normalizeSlide=n,i.slidesEqual=r,i.parseSlide=o,i.jumpToSlide=a},{}],3:[function(e,t,i){var n=e("./reveal-utils"),r=function(){function e(e,t){var i=this;this.cueChangeListener=function(){i.onCueChange()},this.slideChangeListener=function(){i.onSlideChange()},this.video=e,this.track=t,this.initialize()}return e.prototype.initialize=function(){this.activeSlide=null,this.activeCue=null,this.loadSlideMap(),this.onSlideChange(),"oncuechange"in this.track?this.track.addEventListener("cuechange",this.cueChangeListener):this.video.addEventListener("timeupdate",this.cueChangeListener),Reveal.addEventListener("slidechanged",this.slideChangeListener),Reveal.addEventListener("fragmentshown",this.slideChangeListener),Reveal.addEventListener("fragmenthidden",this.slideChangeListener)},e.prototype.dispose=function(){this.activeSlide=null,this.activeCue=null,this.slideMap=null,this.track.removeEventListener("cuechange",this.cueChangeListener),this.video.removeEventListener("timeupdate",this.cueChangeListener),Reveal.removeEventListener("slidechanged",this.slideChangeListener),Reveal.removeEventListener("fragmentshown",this.slideChangeListener),Reveal.removeEventListener("fragmenthidden",this.slideChangeListener),this.video.dispose(),this.video=null},e.prototype.onCueChange=function(){var t=this.track.activeCues.length?this.track.activeCues[0]:null;if(t!==this.activeCue){this.activeCue=t;var i=e.getCueSlide(this.activeCue);i&&!n.slidesEqual(i,this.activeSlide)&&(this.activeSlide=i,n.jumpToSlide(this.activeSlide))}},e.prototype.onSlideChange=function(){var e=n.normalizeSlide(Reveal.getIndices());if(!n.slidesEqual(e,this.activeSlide)){var t=this.findClosestSlideCue(e,this.video.getCurrentTime());t&&this.video.setCurrentTime(t.startTime+.001)}},e.prototype.loadSlideMap=function(){for(var t=this.slideMap={},i=0;i<this.track.cues.length;i++){var n=this.track.cues[i],r=e.getCueSlide(n);if(r){var o=t[r.h]||(t[r.h]={}),a=o[r.v]||(o[r.v]={}),s=a[r.f]||(a[r.f]=[]);s.push(n)}}},e.prototype.findClosestSlideCue=function(e,t){var i=this.slideMap;if(!i)return null;var n=i[e.h],r=n&&n[e.v],o=r&&r[e.f];if(!o)return null;for(var a,s=1/0,d=0;d<o.length;d++){var l=o[d],u=Math.min(Math.abs(l.startTime-t),Math.abs(l.endTime-t));if(l.startTime<=t&&t<l.endTime)return l;s>u&&(a=l,s=u)}return a},e.getCueSlide=function(e){return e&&n.parseSlide(e.text)},e}();i.Synchronizer=r},{"./reveal-utils":2}],4:[function(e,t,i){var n=function(){function e(e){this.video=e}return e.prototype.getCurrentTime=function(){return this.video.currentTime},e.prototype.setCurrentTime=function(e){this.video.currentTime=e},e.prototype.addEventListener=function(e,t){this.video.addEventListener(e,t,!1)},e.prototype.removeEventListener=function(e,t){this.video.removeEventListener(e,t,!1)},e.prototype.onReady=function(e){setTimeout(e,0)},e.prototype.loadSlides=function(e,t){var i=this;return this.unloadSlides(),e?void this.createSlidesTrack(e,function(e,n){return e?void t(e):void i.waitForTrackLoad(function(e){if(e)return void t(e);var i=n.track;i.mode="hidden",t(null,i)})}):void t(new Error("missing slides URL"))},e.prototype.dispose=function(){this.unloadSlides(),this.video=null},e.prototype.waitForMetadata=function(e){var t=this;if(this.video.readyState>=HTMLMediaElement.HAVE_METADATA)return e(null);var i=function(){t.video.removeEventListener("loadedmetadata",i),t.videoMetadataListener===i&&(t.videoMetadataListener=null,e(null))};this.video.addEventListener("loadedmetadata",i),this.videoMetadataListener=i},e.prototype.waitForTrackLoad=function(e){var t=this;if(!this.trackElement)return e(new Error("missing track element"));if(this.trackElement.readyState===HTMLTrackElement.LOADED)return e(null);var i=function(){t.trackElement.removeEventListener("load",i),t.trackLoadListener===i&&(t.trackLoadListener=null,e(null))};this.trackElement.addEventListener("load",i),this.trackLoadListener=i},e.prototype.createSlidesTrack=function(e,t){var i=this;this.waitForMetadata(function(n){if(n)return void t(n);var r=document.createElement("track");r.kind="metadata",r.src=e,r["default"]=!0,i.video.appendChild(r),i.trackElement=r,t(null,r)})},e.prototype.unloadSlides=function(){this.videoMetadataListener&&this.video.removeEventListener("loadedmetadata",this.videoMetadataListener),this.trackElement&&(this.trackLoadListener&&this.trackElement.removeEventListener("load",this.trackLoadListener),this.video.removeChild(this.trackElement)),this.videoMetadataListener=null,this.trackLoadListener=null,this.trackElement=null},e}();i.HTML5Video=n},{}],5:[function(e,t,i){function n(){var e;return l||(l=document.getElementsByClassName(p)[0],l||(l=document.createElement("aside"),l.className=p,e=document.querySelector(".reveal"),e.nextSibling?e.parentNode.insertBefore(l,e.nextSibling):e.parentNode.appendChild(l))),l}function r(){var e=n();return u||(u=e.getElementsByTagName("video")[0],u||(u=document.createElement("video"),u.controls=!0,e.appendChild(u))),u}function o(e,t,i){return e.loadSlides(t,function(t,n){if(t)return void(i&&i(t));var r=new h.Synchronizer(e,n);i&&i(null,r)})}function a(){return r()}function s(e,t,i){var r,a=n();f.isAttached(e)||a.appendChild(e),f.addClass(e,m),r=new c.HTML5Video(e),r.onReady(function(){o(r,t,i)})}function d(e,t,i){var n;return d?(e.addClass(m),e.addClass("video-js"),n=new v.VideoJSVideo(e),void n.onReady(function(){o(n,t,i)})):void(i&&i(new Error("video.js not loaded")))}var l,u,c=e("./video-html5"),v=e("./video-videojs"),h=e("./synchronizer"),f=e("./dom-utils"),p="reveal-video-sync",m="reveal-video-sync-player";i.element=a,i.html5=s,i.videojs=d},{"./dom-utils":1,"./synchronizer":3,"./video-html5":4,"./video-videojs":6}],6:[function(e,t,i){var n=function(){function e(e){this.player=e}return e.prototype.getCurrentTime=function(){return this.player.currentTime()},e.prototype.setCurrentTime=function(e){this.player.currentTime(e)},e.prototype.getSource=function(){return this.player.currentSrc()},e.prototype.setSource=function(e){this.player.src(e)},e.prototype.addEventListener=function(e,t){this.player.on(e,t)},e.prototype.removeEventListener=function(e,t){this.player.off(e,t)},e.prototype.onReady=function(e){this.player.ready(e)},e.prototype.waitForTrackLoad=function(t){var i=this,n=this,r=0,o=function(){clearTimeout(n.cueLoadTimer);var a=n.slidesTrack.cues&&n.slidesTrack.cues.length;a>0&&r===a?t():(r=a,i.cueLoadTimer=setTimeout(o,e.cueLoadTimeout))};o()},e.prototype.loadSlides=function(e,t){var i=this;return this.unloadSlides(),e?(this.slidesTrack=this.player.addRemoteTextTrack({kind:"metadata",mode:"showing","default":!0,src:e}).track,void this.waitForTrackLoad(function(){t(null,i.slidesTrack)})):void t(new Error("missing slides URL"))},e.prototype.dispose=function(){this.unloadSlides(),this.player=null},e.prototype.unloadSlides=function(){clearTimeout(this.cueLoadTimer),this.slidesTrack&&(this.player.removeRemoteTextTrack(this.slidesTrack),this.slidesTrack=null)},e.cueLoadTimeout=100,e}();i.VideoJSVideo=n},{}]},{},[5])(5)});
//# sourceMappingURL=video-sync.min.js.map
